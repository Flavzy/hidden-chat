<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Chat Rooms</title>
    <style>
        /* TEMA HACKER TETAP DIPERTAHANKAN */
        body { background-color: #0d1117; color: #00ff41; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Layar Login Room */
        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .box { border: 1px solid #333; padding: 20px; background: #161b22; width: 300px; text-align: center; }
        
        /* Layar Chat (Awalnya disembunyikan) */
        #chat-screen { display: none; flex-direction: column; height: 100%; }
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; border-bottom: 1px solid #333; }
        #form-container { display: flex; padding: 10px; background: #161b22; }
        
        input { background: #000; border: 1px solid #333; color: #00ff41; padding: 10px; outline: none; width: 80%; margin-bottom: 10px; }
        button { background: #238636; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        button:hover { background: #2ea043; }
        
        .message { margin-bottom: 5px; }
        .system-msg { color: #ff5555; font-style: italic; }
        .my-msg { color: #58a6ff; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="box">
            <h3>// JOIN SECURE ROOM</h3>
            <input id="username" placeholder="Codename (e.g. Ghost)" autocomplete="off">
            <input id="room-name" placeholder="Room ID (e.g. Secret123)" autocomplete="off">
            <button onclick="joinRoom()">CONNECT</button>
        </div>
    </div>

    <div id="chat-screen">
        <div id="chat-header" style="padding:10px; background:#21262d; border-bottom:1px solid #333;">
            Status: Connected to [<span id="current-room"></span>]
        </div>
        <div id="chat-container"></div>
        <form id="form-container">
            <input id="input" autocomplete="off" placeholder="Enter encrypted message..." />
            <button>SEND</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // Variabel untuk menyimpan data user
        let myUser = '';
        let myRoom = '';

        const loginScreen = document.getElementById('login-screen');
        const chatScreen = document.getElementById('chat-screen');
        const messages = document.getElementById('chat-container');
        const form = document.getElementById('form-container');
        const input = document.getElementById('input');

        // Fungsi Join Room
        function joinRoom() {
            const userVal = document.getElementById('username').value;
            const roomVal = document.getElementById('room-name').value;

            if(userVal && roomVal) {
                myUser = userVal;
                myRoom = roomVal;

                // Kirim sinyal ke server untuk masuk room
                socket.emit('join_room', myRoom);

                // Ganti tampilan
                loginScreen.style.display = 'none';
                chatScreen.style.display = 'flex';
                document.getElementById('current-room').innerText = myRoom;
            } else {
                alert("Username and Room ID required!");
            }
        }

        // Kirim Pesan
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value) {
                // Kirim pesan + data room ke server
                socket.emit('chat_message', { 
                    room: myRoom, 
                    user: myUser, 
                    text: input.value 
                });
                input.value = '';
            }
        });

        // Terima Pesan Chat
        socket.on('chat_message', (msg) => {
            const item = document.createElement('div');
            item.className = 'message';
            // Bedakan warna pesan sendiri vs orang lain
            const colorClass = (msg.user === myUser) ? 'my-msg' : ''; 
            
            item.innerHTML = `<span class="${colorClass}">[${msg.user}]:</span> ${msg.text}`;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });

        // Terima Pesan Sistem (Join/Leave)
        socket.on('system_message', (msg) => {
            const item = document.createElement('div');
            item.className = 'message system-msg';
            item.innerText = `> SYSTEM: ${msg}`;
            messages.appendChild(item);
        });
    </script>
</body>
</html>